<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.imnoob.community.mapper.QuestionMapper">

    <insert id="createQuestion" parameterType="Question">
        insert into
        t_question (title,description,creator,gmt_create,tag)
        values
        (#{title},#{description},#{creator},#{gmtCreate},#{tag})
    </insert>

    <select id="findAllQuestions" resultType="Question">
        SELECT * FROM t_question WHERE status = 1 or status = 2
    </select>

    <select id="findQuestionsById" resultType="Question" parameterType="java.lang.Long">
        SELECT * FROM t_question WHERE creator = #{id}
    </select>

    <select id="findQuestionById" resultType="Question" parameterType="java.lang.Long">
        SELECT * FROM t_question WHERE id = #{id}
    </select>

    <update id="modifiedQuestion" parameterType="Question">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun Jan 10 02:53:25 CST 2021.
        -->
        update t_question
        <set>
            <if test="question.id != null">
                ID = #{question.id,jdbcType=BIGINT},
            </if>
            <if test="question.title != null">
                TITLE = #{question.title,jdbcType=VARCHAR},
            </if>
            <if test="question.gmtCreate != null">
                GMT_CREATE = #{question.gmtCreate,jdbcType=BIGINT},
            </if>
            <if test="question.gmtModified != null">
                GMT_MODIFIED = #{question.gmtModified,jdbcType=BIGINT},
            </if>
            <if test="question.creator != null">
                CREATOR = #{question.creator,jdbcType=BIGINT},
            </if>
            <if test="question.commentCount != null">
                COMMENT_COUNT = #{question.commentCount,jdbcType=INTEGER},
            </if>
            <if test="question.viewCount != null">
                VIEW_COUNT = #{question.viewCount,jdbcType=INTEGER},
            </if>
            <if test="question.likeCount != null">
                LIKE_COUNT = #{question.likeCount,jdbcType=INTEGER},
            </if>
            <if test="question.tag != null">
                TAG = #{question.tag,jdbcType=VARCHAR},
            </if>

            <if test="record.description != null">
                DESCRIPTION = #{record.description,jdbcType=CLOB},
            </if>
        </set>
    </update>

    <update id="incView" parameterType="java.lang.Long">
        update
            t_question
        SET view_count = view_count + 1
        WHERE id = #{id}
    </update>

    <update id="incLike" parameterType="java.lang.Long">
        update
            t_question
        SET like_count = like_count + 1
        WHERE id = #{id}
    </update>

    <update id="incCommentCount" parameterType="java.lang.Long">
        update
            t_question
        SET comment_count = comment_count + 1
        WHERE id = #{id}
    </update>

    <select id="selectByTag" parameterType="java.lang.String" resultType="Question">
        SELECT * FROM t_question
        WHERE tag REGEXP #{tag,jdbcType=VARCHAR}
        order by comment_count desc
        LIMIT 0 , 10
    </select>


</mapper>